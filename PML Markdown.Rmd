---
title: "PML Project"
author: "Yilei Yang"
date: "November 16, 2018"
output: html_document
---

```{r}
suppressMessages(library(caret))
suppressMessages(library(rpart))
suppressMessages(library(rpart.plot))
suppressMessages(library(dplyr))
suppressMessages(library(randomForest))

#read in training and test data
pmlTrain <-read.csv("C:/coursera/ML/pml-training.csv", header = TRUE)
str(pmlTrain)

pmlTest <-read.csv("C:/coursera/ML/pml-testing.csv", header = TRUE)
str(pmlTest)

#The first seven columns appear to be irrelevant data to the prediction
pmlTrainSub <- select(pmlTrain,8:160)
pmlTestSub <- select(pmlTest,8:160)

#Many columns have high numbers of NAs, so remove any column that has NAs
pmlTrainSub2 <- pmlTrainSub[apply(pmlTestSub, 2, function(x) sum(is.na(x))) == 0]
pmlTestSub2 <- pmlTestSub[apply(pmlTestSub, 2, function(x) sum(is.na(x))) == 0]

#partition into training and test sets
set.seed(125)
inTrain = createDataPartition(pmlTrainSub2$classe, p = .75)[[1]]
training = pmlTrainSub2[ inTrain,]
testing = pmlTrainSub2[-inTrain,]

#nrow(pmlTrainSub2)
#nrow(training)
#nrow(testing)
#str(training)

#Run decision tree model
cartModel <- rpart(classe ~ ., data = training, method = 'class', xval = 5)
print(cartModel)

predictionsCart <- predict(cartModel, testing, type = "class")
#Accuracy of 75%
confusionMatrix(predictionsCart, testing$classe)

#Try random forest model
rfModel <- randomForest(classe ~ ., data = training)
print(rfModel)

#Accuracy of > 99%
predictionsRF <- predict(rfModel, testing, type = "class")
confusionMatrix(predictionsRF, testing$classe)


finalPredictions <- predict(rfModel, pmlTestSub2)

#final predictions
print(finalPredictions)

```

